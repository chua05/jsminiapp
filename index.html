<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JavaScript Mini Web App - Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  

  <div class="layout">


    <main class="main">
      <section class="grid">
        <div class="card form-card">
          <div class="card-header">
            <h2>USER FORM</h2>
          </div>

          <div class="error" id="error_msg"></div>

          <form id="user_form" class="form">
            <div class="form-row">
              <label>Name</label>
              <input type="text" id="name" name="name" required />
            </div>

            <div class="form-row">
              <label>Email</label>
              <input type="email" id="email" name="email" required />
            </div>

            <div class="form-row">
              <label>Age</label>
              <input type="number" id="age" name="age" required />
            </div>

            <div class="form-row">
              <label>Address</label>
              <input type="text" id="address" name="address" required />
            </div>

            <div class="form-row">
              <label>Gender</label>
              <select id="gender" name="gender">
                <option value="">select..</option>
                <option value="f">Female</option>
                <option value="m">Male</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-row">
              <label>Comments</label>
              <textarea id="comments" name="comments"></textarea>
            </div>

            <div class="button-row">
              <button id="submit_btn" class="btn primary" type="submit">Submit</button>
              <button type="button" id="clear_all" class="btn">Clear</button>
              <button type="button" id="cancel_edit" class="btn ghost" style="display: none;">Cancel Edit</button>
            </div>
          </form>
        </div>

        <div class="card table-card">
          <div class="card-header">
            <h2>Users</h2>
            <div class="controls">
              <input type="text" id="search_input" placeholder="Search by name..." />
              <button id="sort_name" class="btn small">Sort</button>
            </div>
          </div>

          <div class="table-wrap">
            <table id="user_table" class="table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Age</th>
                  <th>Address</th>
                  <th>Gender</th>
                  <th>Comments</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const form = document.getElementById('user_form');
    const error_msg = document.getElementById('error_msg');
    const table_body = document.querySelector('#user_table tbody');
    const clear_all = document.getElementById('clear_all');
    const submit_btn = document.getElementById('submit_btn');
    const cancel_edit = document.getElementById('cancel_edit');
    const search_input = document.getElementById('search_input');
    const sort_name_btn = document.getElementById('sort_name');
    let editIndex = null;

    document.addEventListener("DOMContentLoaded", loadData);

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const age = parseInt(form.age.value);
      const address = form.address.value.trim();
      const gender = form.gender.value;
      const comments = form.comments.value.trim();

      if (!name || !email || !age || !address || !gender) {
        error_msg.textContent = "All fields except comments are required!";
        return;
      }
      if (age < 18) {
        error_msg.textContent = "Age must be at least 18.";
        return;
      }
      if (!/\S+@\S+\.\S+/.test(email)) {
        error_msg.textContent = "Invalid email format.";
        return;
      }

      error_msg.textContent = "";
      let users = JSON.parse(localStorage.getItem('users')) || [];

      if (editIndex !== null) {
        users[editIndex] = { name, email, age, address, gender, comments };
      } else {
        users.push({ name, email, age, address, gender, comments });
      }

      localStorage.setItem('users', JSON.stringify(users));
      form.reset();
      editIndex = null;
      submit_btn.textContent = "Submit";
      cancel_edit.style.display = "none";
      loadData();
    });

    function loadData() {
      let users = JSON.parse(localStorage.getItem('users')) || [];
      table_body.innerHTML = "";
      users.forEach((user, index) => {
        let row = `
        <tr>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.age}</td>
          <td>${user.address}</td>
          <td>${user.gender}</td>
          <td>${user.comments}</td>
          <td>
            <button class="btn tiny" onclick="editUser(${index})">Edit</button>
            <button class="btn tiny danger" onclick="deleteUser(${index})">Delete</button>
          </td>
        </tr>`;
        table_body.innerHTML += row;
      });
    }

    function deleteUser(index) {
      if (confirm("Are you sure you want to delete this user?")) {
        let users = JSON.parse(localStorage.getItem('users')) || [];
        users.splice(index, 1);
        localStorage.setItem('users', JSON.stringify(users));
        loadData();
      }
    }

    function editUser(index) {
      let users = JSON.parse(localStorage.getItem('users')) || [];
      const u = users[index];
      if (!u) return;
      form.name.value = u.name;
      form.email.value = u.email;
      form.age.value = u.age;
      form.address.value = u.address;
      form.gender.value = u.gender;
      form.comments.value = u.comments;
      editIndex = index;
      submit_btn.textContent = "Update";
      cancel_edit.style.display = "inline-block";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    cancel_edit.addEventListener('click', () => {
      form.reset();
      editIndex = null;
      submit_btn.textContent = "Submit";
      cancel_edit.style.display = "none";
    });

    // clear form only (keeps saved records)
    clear_all.addEventListener('click', () => {
      if (confirm("Clear form fields?")) {
        form.reset();
        editIndex = null;
        submit_btn.textContent = "Submit";
        cancel_edit.style.display = "none";
        error_msg.textContent = "";
        form.name.focus();
      }
    });

    search_input.addEventListener('input', () => {
      const term = search_input.value.toLowerCase();
      const rows = table_body.querySelectorAll('tr');
      rows.forEach(row => {
        const name = row.children[0].textContent.toLowerCase();
        row.style.display = name.includes(term) ? "" : "none";
      });
    });

    sort_name_btn.addEventListener('click', () => {
      let users = JSON.parse(localStorage.getItem('users')) || [];
      users.sort((a, b) => a.name.localeCompare(b.name));
      localStorage.setItem('users', JSON.stringify(users));
      loadData();
    });
  </script>
</body>
</html>
